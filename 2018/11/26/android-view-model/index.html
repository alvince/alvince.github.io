<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head><meta name="generator" content="Hexo 3.8.0">

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="è¿™æ˜¯ä¸ªçœ‹å¿ƒæƒ…éšç¼˜æ›´æ–°çš„åšå®¢">
    

    <!--Author-->
    
        <meta name="author" content="æ¨å°å’©">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="Android-ViewModel ä½¿ç”¨æŒ‡åŒ—">
    

    <!--Open Graph Description-->
    
        <meta property="og:description" content="è¿™æ˜¯ä¸ªçœ‹å¿ƒæƒ…éšç¼˜æ›´æ–°çš„åšå®¢">
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="Coco SAMA çš„é“²å±å®˜">

    <!--Type page-->
    
        <meta property="og:type" content="article">
    

    <!--Page Cover-->
    

    <meta name="twitter:card" content="summary">
    

    <!-- Title -->
    
    <title>Android-ViewModel ä½¿ç”¨æŒ‡åŒ— - Coco SAMA çš„é“²å±å®˜</title>

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css" integrity="sha384-y3tfxAZXuh4HwSYylfB+J125MxIs6mR5FOHamPBG064zB+AFeWH94NdvaCBm8qnd" crossorigin="anonymous">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- Google Analytics -->
    


</head>


<body>

<div class="bg-gradient"></div>
<div class="bg-pattern"></div>

<!-- Menu -->
<!--Menu Links and Overlay-->
<div class="menu-bg">
    <div class="menu-container">
        <ul>
            
            <li class="menu-item">
                <a href="/">
                    Home
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/archives">
                    Archives
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/about.html">
                    About
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/tags">
                    Tags
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/categories">
                    Categories
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/contact.html">
                    Contact
                </a>
            </li>
            
        </ul>
    </div>
</div>

<!--Hamburger Icon-->
<nav>
    <a href="#menu"></a>
</nav>

<div class="container">

    <!-- Main Content -->
    <div class="row">
    <div class="col-sm-12">

        <!--Title and Logo-->
        <header>
    <div class="logo">
        <a href="/"><i class="logo-icon fa fa-cube" aria-hidden="true"></i></a>
        
    </div>
</header>

        <section class="main">
            
<div class="post">

    <div class="post-header">
        <h1 class="title">
            <a href="/2018/11/26/android-view-model/">
                Android-ViewModel ä½¿ç”¨æŒ‡åŒ—
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2018-11-26</span>
            
            
            
        </div>
    </div>

    <div class="content">

        <!-- Gallery -->
        

        <!-- Post Content -->
        <p><code>Android</code> å¼€å‘è¿‘å¹´è¶Šæ¥è¶Šè¶‹äºæˆç†Ÿç¨³å®šï¼Œå¾ˆå¤šç¬¬ä¸‰æ–¹ç»„ä»¶ä¹Ÿè¶Šæ¥è¶Šå®Œå–„ï¼Œä¸ŠåŠå¹´ <code>Google</code> çˆ¸çˆ¸å‘å¸ƒäº†åä¸º <code>Jetpack</code> çš„å·¥å…·åŒ…å ªç§°åº”ç”¨å¼€å‘è€…çš„ç¦éŸ³ï¼Œè¿™é‡Œå°±è®¨è®ºä¸€ä¸‹è¿™ä¸ªå¼€å‘å¥—ä»¶ä¸­ <code>ViewModel</code> åˆ°åº•æ˜¯ä¸ªä»€ä¹ˆæ ·çš„å­˜åœ¨ã€‚</p>
<h2 id="ä»€ä¹ˆæ˜¯-Jetpack"><a href="#ä»€ä¹ˆæ˜¯-Jetpack" class="headerlink" title="ä»€ä¹ˆæ˜¯ Jetpack"></a>ä»€ä¹ˆæ˜¯ Jetpack</h2><p>å…ˆè¯´ä¸€ä¸‹ <a href="https://developer.android.com/jetpack/" target="_blank" rel="noopener">Jetpack</a>ï¼Œå®˜æ–¹å¯¹æ­¤ä»‹ç»æ˜¯å¸®åŠ©å¼€å‘è€…ä¸“æ³¨åº”ç”¨çš„ä¸šåŠ¡ä»£ç ã€æ›´è½»æ¾åœ°å¼€å‘å‡ºè‰²çš„åº”ç”¨ç¨‹åºçš„ä¸€ä¸ª Android è½¯ä»¶å¼€å‘ç»„ä»¶é›†åˆ  </p>
<blockquote>
<p>Jetpack is a collection of Android software components to make it easier for you to develop great Android apps.<br>These components help you follow best practices, free you from writing boilerplate code, and simplify complex tasks, so you can focus on the code you care about.</p>
</blockquote>
<p>é‡Œé¢åŒ…å«äº†å‡ ä¹æ‰€æœ‰å¼€å‘ Android App èƒ½ç”¨åˆ°çš„æ¶‰åŠç¨‹åºæ¶æ„ã€å¯¼èˆªã€UIã€è¡Œä¸ºç›¸å…³çš„ç»„ä»¶åº“</p>
<ul>
<li>Foundation<br><code>AppCompat</code>, <code>Android KTX</code>, <code>Multidex</code>, <code>Test</code></li>
<li>Architecture<br><code>Data Binding</code>, <code>Lifecycles</code>, <code>LiveData</code>, <code>Navigation</code>, <code>Paging</code>, <code>Room</code>, <code>ViewModel</code>, <code>WorkManager</code></li>
<li>Behavior<br><code>Download manager</code>, <code>Media &amp; playback</code>, <code>Notifications</code>, <code>Permissions</code>, <code>Preferences</code>, <code>Sharing</code>, <code>Slices</code></li>
<li>UI<br><code>Animation &amp; transitions</code>, <code>Auto</code>, <code>Emoji</code>, <code>Fragment</code>, <code>Layout</code>, <code>Palette</code>, <code>TV</code>, <code>Wear OS by Google</code></li>
</ul>
<p>åœ¨è¿™é‡Œå°±æ¥åˆ†æä¸€ä¸‹ <code>ViewModel</code> åˆ°åº•åº”è¯¥æ€ä¹ˆä½¿ç”¨</p>
<h2 id="Android-åº”ç”¨ç¨‹åºæ¶æ„"><a href="#Android-åº”ç”¨ç¨‹åºæ¶æ„" class="headerlink" title="Android åº”ç”¨ç¨‹åºæ¶æ„"></a>Android åº”ç”¨ç¨‹åºæ¶æ„</h2><p>è®¨è®º ViewModel ä¹‹å‰éœ€è¦å…ˆå¼„æ¸…æ¥šä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯é€šå¸¸åœ¨ Android App å¼€å‘ä¸­ä½¿ç”¨è½¯ä»¶åº”ç”¨ç¨‹åºæ¶æ„ã€‚<br>Google çˆ¸çˆ¸åŒæ ·å‘å¸ƒäº†ä¸€ç³»åˆ—è½¯ä»¶æ¶æ„çš„ç¤ºä¾‹å‚è€ƒ ğŸ‘‰  <a href="https://github.com/googlesamples/android-architecture" target="_blank" rel="noopener">android-architecture</a></p>
<p>åœ¨ 8012 å¹´çš„ä»Šå¤©ï¼Œ<strong>MVC</strong> è¿™ç§ä¸Šå¤æ—¶ä»£çš„ç§»åŠ¨è½¯ä»¶æ¶æ„åº”è¯¥å·²ç»æ·˜æ±°çš„å·®ä¸å¤šäº†ï¼Œå…ˆè¯´ä¸€ä¸‹ <strong>MVP</strong> è¿™ä¸ªç°åœ¨å‡ ä¹è½¯ä»¶å¿…å¤‡çš„è½¯ä»¶æ¶æ„ã€‚</p>
<h4 id="MVP"><a href="#MVP" class="headerlink" title="MVP"></a>MVP</h4><p>æ‰€è°“ <code>MVP</code> å°±æ˜¯æŠŠç¨‹åºä»£ç  æŒ‰ç…§ <strong>model-view-presenter</strong> åˆ†å±‚è§£è€¦<br><code>Presenter</code> é€šå¸¸æ˜¯é€šè¿‡å¯¹ ç½‘ç»œå±‚è°ƒç”¨ã€æ•°æ®è§£æã€ä¸šåŠ¡å¤„ç†ä»¥åŠå…¶ä»–é€»è¾‘ä»£ç çš„å°è£…<br>ç„¶åé€šè¿‡å¯¹ <code>View</code> å±‚æ¥å£çš„è°ƒç”¨æ¥é€šçŸ¥ <code>UI</code> ç•Œé¢æ›´æ–°<br>é€šè¿‡å°† <strong>æ•°æ®</strong>ã€<strong>è§†å›¾</strong>ã€<strong>é€»è¾‘</strong> ä¸‰å±‚ä»£ç éš”ç¦»æ¥è¾¾åˆ°è§£è€¦çš„ç›®çš„<br>ä½†æ˜¯è¿™ç§æ¶æ„æœ‰ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯ <code>Presenter</code> éå¸¸ä¾èµ– <code>View</code> å±‚çš„æ¥å£  </p>
<p>è¿™ç§æ¨¡å¼ä¸‹ï¼Œé€»è¾‘-è§†å›¾ä¹‹é—´çš„é€šè®¯å®Œå…¨ä¾èµ–äº View å±‚çš„æ¥å£ï¼Œä¸€æ—¦ä¸šåŠ¡å‘ç”Ÿäº†å˜æ›´ï¼Œéœ€è¦ä¿®æ”¹ View å±‚æ¥å£çš„å£°æ˜ã€Presenter å¯¹ View é€šçŸ¥è°ƒç”¨çš„å…¥å£ã€ä»¥åŠ <code>Activity</code> / <code>Fragment</code> ç­‰è§†å›¾æ¥å£çš„å®ç°  </p>
<h4 id="MVVM"><a href="#MVVM" class="headerlink" title="MVVM"></a>MVVM</h4><p>é‚£ä¹ˆåœ¨è¿™ç§æƒ…å†µä¸‹ <code>Android</code> å¼€å‘çš„å…³æ³¨ç„¦ç‚¹è½¬ç§»åˆ°äº† <code>MVVM</code> æ¶æ„æ¨¡å¼<br>è¿™ç§æ¨¡å¼å…¶å®æ˜¯å¯¹ <code>MVC</code> çš„å¦ä¸€å±‚å˜ç§ï¼Œè¿™é‡Œçš„ <code>VM</code> æŒ‡çš„å°±æ˜¯ <code>ViewModel</code>ï¼ˆè·Ÿä¸‹é¢è®¨è®ºçš„ Architecture ViewModel ä¸ä¸€æ ·ï¼‰<br>åŒºåˆ«äº <code>MVP</code> å¯¹ä¸šåŠ¡é€»è¾‘çš„å®Œå…¨æŠ½ç¦»ï¼Œ<code>MVVM</code> åœ¨è§†å›¾ä¹‹ä¸ŠæŠ½è±¡å‡ºäº†ä¸€ä¸ª <code>ViewModel</code> çš„æ¦‚å¿µï¼Œè¿™ä¸ªå±‚é¢å…³æ³¨äº†ç•Œé¢è§†å›¾æ‰€å…³è”çš„ <strong>æ•°æ® + é€»è¾‘</strong> çš„æ“ä½œ  </p>
<p>æœ‰è¿‡ç½‘é¡µå‰ç«¯æˆ–è€… iOS ç›¸å…³å¼€å‘ç»éªŒçš„åŒå­¦åº”è¯¥èƒ½å¤Ÿäº†è§£ï¼Œå…¶å®å°±æ˜¯ <strong>Data Binding</strong> è¿™ç§å¼€å‘æ¨¡å¼<br>é€šè¿‡å°†æ•°æ®ç»‘å®šåˆ°è§†å›¾å±‚ï¼Œæ›´æ–°ç›¸åº”çš„æ•°æ® Model æ¥è§¦å‘UIè§†å›¾çš„çŠ¶æ€æ›´æ–°<br>ä¸€ä¸ªå…¸å‹çš„åœºæ™¯å°±æ˜¯åŸºäº <code>React</code> ç¯å¢ƒçš„å¼€å‘ï¼Œé€šè¿‡æ”¹å˜ç»„ä»¶çš„ <code>props</code> å’Œ <code>state</code> æ¥é€šçŸ¥ UI è§†å›¾åˆ·æ–°æ˜¾ç¤ºå†…å®¹</p>
<p>å…³äº <code>MVVM</code> çš„æ›´å¤šå†…å®¹è¿™é‡Œä¸å±•å¼€ç»†è¯´ï¼Œä¸‹é¢å¼€å§‹è®¨è®ºä¸€ä¸‹ <code>Android Jetpack</code> æ¶æ„ç»„ä»¶ä¸­ <code>ViewModel</code> çš„ä½¿ç”¨</p>
<h2 id="ViewModel"><a href="#ViewModel" class="headerlink" title="ViewModel"></a>ViewModel</h2><p><a href="https://developer.android.com/topic/libraries/architecture/viewmodel" target="_blank" rel="noopener">ViewModel</a> è¿™ä¸ªç»„ä»¶æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>å®˜æ–¹ä»‹ç»æ˜¯è¿™æ ·çš„ï¼š</p>
<blockquote>
<p>The ViewModel class is designed to store and manage UI-related data in a lifecycle conscious way.<br>The ViewModel class allows data to survive configuration changes such as screen rotations.</p>
</blockquote>
<p>è¿™é‡Œæ˜ç¡®è¯´æ˜äº† ViewModel æ˜¯å‡ºäºç®¡ç†å’Œå­˜å‚¨ UI ç›¸å…³æ•°æ®çš„ç›®çš„ï¼Œé€šè¿‡å¯¹ Android ç»„ä»¶ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥çš„æ–¹å¼è€Œè®¾è®¡å‡ºæ¥çš„ä¸€ä¸ªç»„ä»¶ï¼Œå¹¶ä¸”å…è®¸åœ¨è®¾å¤‡çš„é…ç½®å‘ç”Ÿå˜æ›´ï¼ˆå¦‚å±å¹•æ—‹è½¬ï¼‰æ—¶ç»§ç»­ä¿æŒã€‚</p>
<p>è¿™æ ·çš„è¯æœ€ç›´æ¥çš„å¥½å¤„å°±æ˜¯å¼€å‘è€…ä¸å†éœ€è¦å…³å¿ƒ <code>Activity</code> / <code>Fragment</code> çš„ç›¸å…³çŠ¶æ€æ•°æ®æŒä¹…åŒ–ï¼ˆsaveInstanceStatusï¼‰çš„é—®é¢˜äº†ï¼Œèƒ½å¤Ÿä¸“æ³¨äºäº§å“ä¸šåŠ¡çš„å¼€å‘ï¼Œé¿å…ç¼“å­˜æ¢å¤æ•°æ®è¿™ç§é‡å¤æ¨¡æ¿åŒ–æ“ä½œã€‚</p>
<p>è¿™æ˜¯å®˜æ–¹æ–‡æ¡£ä¸Šå¯¹ ViewModel å¦‚ä½•å·¥ä½œçš„ç¤ºæ„å›¾ ğŸ‘‡</p>
<div style="background:white"><br><img src="http://pic.ffsky.net/images/2018/11/27/9ad50f26af937fd6731d13f327b1a930.png" alt="Illustrates the lifecycle of a ViewModel as an activity changes state."><br><img src="http://pic.ffsky.net/images/2018/11/27/e2367f4091012a8eeaf42352dceee7c9.png" alt="viewmodel-loader"><br><img src="http://pic.ffsky.net/images/2018/11/27/23294c647338dbebd78a55684320f56c.png" alt="viewmodel-replace-loader"><br></div><br><p><br><br>å¯ä»¥çœ‹åˆ° <code>ViewModel</code> è·Ÿéš <code>Activity</code> åˆ›å»ºä¹‹åä¼šä¸€ç›´åœ¨åœ¨å†…å­˜ä¸­ç”Ÿå­˜å¹¶ä¸”å·¥ä½œ<br>ç›´åˆ°ä¸å…¶å…³è”çš„ <code>Activity</code> é”€æ¯ <code>destroy</code> æ—¶ï¼Œä¼šè§¦å‘ä¸€ä¸ªå« <code>onCleared</code> çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œæœ€åå®£å‘Šæ­»äº¡ã€‚<br><br><strong>ViewModel</strong> çš„ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥ä¾èµ–äº <code>Jetpack</code> çš„å¦ä¸€ä¸ªç»„ä»¶ <a href="https://developer.android.com/topic/libraries/architecture/lifecycle" target="_blank" rel="noopener">Lifecycles</a><br>å…³äº <code>Lifecycles</code> è¿™é‡Œä¸è¯¦ç»†å±•å¼€ï¼Œåªéœ€æ˜ç¡® <code>Lifecycles</code> é€šè¿‡å¯¹ <code>Activity</code> ç”Ÿå‘½å‘¨æœŸçš„æ•è·æ¥è§¦å‘ç”Ÿå‘½å‘¨æœŸäº‹ä»¶çš„ä¸ŠæŠ¥æ¥è¾¾åˆ°ç›‘æ§ç”Ÿå‘½å‘¨æœŸçš„ç›®çš„<br><br>åŸºäº <code>Lifecycles</code> æ„å‘³ç€å¼€å‘è€…ä¸å†éœ€è¦æ‰‹åŠ¨å…³æ³¨ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸé—®é¢˜ï¼Œé‚£ä¹ˆ <code>ViewModel</code> æ˜¯å¦‚ä½•æ„ŸçŸ¥å¹¶ä¸”åŒæ­¥åº”ç”¨ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸå‘¢ï¼Ÿ<br><br>é€šè¿‡æŸ¥çœ‹ <code>ViewModel</code> æºä»£ç å¯ä»¥çœ‹å‡ºï¼Œå®ƒæœ¬èº«å…¶å®å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„ Java Beanï¼Œæ²¡æœ‰ä»»ä½•å¤æ‚çš„åœ°æ–¹<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">ViewModel</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * This method will be called when this ViewModel is no longer used and will be destroyed.</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * It is useful when ViewModel observes some data and you need to clear this subscription to</span></span><br><span class="line"><span class="comment">     * prevent a leak of this ViewModel.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"WeakerAccess"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCleared</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><br>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œè¿™æ ·åªæ€ä¹ˆå®ç°æ•°æ®å’Œç”Ÿå‘½å‘¨æœŸçš„ç®¡ç†å‘¢<br><br><div><br><img src="http://pic.ffsky.net/images/2018/11/26/7d5e164647c71a88dca23044abe0242a.png" alt="7d5e164647c71a88dca23044abe0242a.png" style="margin-left:0"><br></div>

</p><p>ç¿»çœ‹ viewmodel çš„æºä»£ç ä¼šå‘ç°è¿™ä¸ªåº“å®åœ¨æ˜¯ç®€å•åˆ°äº†æç‚¹ï¼Œåªæœ‰å‡ ä¸ªç±»å’Œæ¥å£ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ <code>Jetpack</code> ç»„ä»¶æ˜¯åº”è¯¥ä¾èµ– <code>AppCompat</code> å…¼å®¹å¥—ä»¶äº†<br>å› ä¸º <code>Jetpack</code> å®ç°ç”Ÿå‘½å‘¨æœŸç›¸å…³çš„ç»„ä»¶å…¶å®æ˜¯åŸºäº <strong>support-v4</strong> æ¥å®ç°ï¼Œé€šè¿‡ <code>FragmentActivity</code> æ¥å®ç°ç»„ä»¶ç›¸å…³çš„æ¥å£æ¥å®Œæˆå¯¹ <code>ViewModel</code> çš„ç®¡ç†çš„<br>è‡³äºå…·ä½“æ˜¯æ€ä¹ˆå®ç°è¿™ä¸ªç®¡ç†è¿‡ç¨‹ï¼Œè¿™é‡Œæš‚ä¸ç»†è®²ï¼Œæœ‰å…´è¶£å¯ä»¥è‡ªè¡Œé˜…è¯» <code>FragmentActivity</code> çš„æºç </p>
<h4 id="åˆ›å»º-ViewModel"><a href="#åˆ›å»º-ViewModel" class="headerlink" title="åˆ›å»º ViewModel"></a>åˆ›å»º ViewModel</h4><p>è¦ä½¿ç”¨ <code>ViewModel</code> æ¥ç®¡ç†æ•°æ®ï¼Œé¦–å…ˆéœ€è¦å£°æ˜ä¸€ä¸ª model ç±»æ¥é›†æˆ <strong>android.arch.lifecycle.ViewModel</strong><br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SampleModel</span> : <span class="type">ViewModel</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> profile: UserInfo? = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCleared</span><span class="params">()</span></span> &#123;</span><br><span class="line">        profile = <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å›åˆ°æ­£é¢˜ï¼Œå®é™…å¼€å‘ä¸­è¦æ€ä¹ˆæ¥ä½¿ç”¨ ViewModel å‘¢ï¼Ÿ<br>åº“ä¸­æä¾›äº†ä¸€ä¸ª <code>ViewModelProviders</code> çš„å·¥å…·ç±»æ¥å¸®åŠ©åˆ›å»º <code>ViewModel</code></p>
<div style="align:left"><br><img src="http://pic.ffsky.net/images/2018/11/26/a9e53786ae08929990cafda692b4b330.png" alt="a9e53786ae08929990cafda692b4b330.png" style="margin-left:0"><br></div>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SampleActivity</span> : <span class="type">AppCompatActivity</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> viewModel <span class="keyword">by</span> lazy &#123; ViewModelProviders.of(activity).<span class="keyword">get</span>(SimpleModel::<span class="class"><span class="keyword">class</span>.<span class="title">java</span>) &#125;</span></span><br><span class="line">    â€¦</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ®µä»£ç åœ¨éœ€è¦ä½¿ç”¨åˆ° viewmodel çš„æ—¶å€™é€šè¿‡ <strong>ViewModelProfiders#of(FragmentActivity)</strong> æ¥åˆ›å»ºä¸€ä¸ª <code>ViewModelProvider</code>ï¼Œç„¶åè°ƒç”¨ <code>get</code> æ–¹æ³•åˆ›å»ºå‡ºæ‰€éœ€è¦çš„ <code>model</code> å®ä¾‹<br>éå¸¸ç®€å•åœ°ä»£ç ï¼Œåˆ°è¿™é‡Œ viewmodel çœ‹ä¸Šå»å¥½åƒå·²ç»è¯´å®Œäº†<br>â€¦<br>ç›é¹…æ€ä¹ˆå¯èƒ½å‘¢ï¼Œè®²åˆ°è¿™é‡Œå¥½åƒè·Ÿ <code>MVVM</code> è¿˜æ˜¯æ²¡ä»€ä¹ˆå¤ªå¤§çš„å…³ç³»<br>é‚£ä¹ˆè¿™é‡Œéœ€è¦ä»‹ç» <strong>Jetpack Architecture</strong> çš„å¦ä¸€ä¸ªé‡è¦çš„ç»„ä»¶ <strong>LiveData</strong> äº†  </p>
<h2 id="LiveData"><a href="#LiveData" class="headerlink" title="LiveData"></a>LiveData</h2><p>è¿˜æ˜¯å…ˆçœ‹å®˜æ–¹è¯´æ˜</p>
<blockquote>
<p>LiveData is an observable data holder class. Unlike a regular observable, LiveData is lifecycle-aware, meaning it respects the lifecycle of other app components, such as activities, fragments, or services.<br>This awareness ensures LiveData only updates app component observers that are in an active lifecycle state.</p>
</blockquote>
<p>è¿™é‡Œå·²ç»æ¸…æ™°çš„ä»‹ç»äº† LiveData æ˜¯ä¸€ä¸ªå¯è§‚å¯Ÿçš„æ•°æ®æŒæœ‰ç±»ï¼Œè€Œä¸”è·Ÿæ™®é€šçš„è§‚å¯Ÿè€…ä¸ä¸€æ ·çš„åœ°æ–¹åœ¨äº<br>LiveData å¯ä»¥æ„ŸçŸ¥ Android ç³»ç»Ÿç»„ä»¶ç”Ÿå‘½å‘¨æœŸï¼Œå¹¶ä¸”åªåœ¨è§‚å¯Ÿè€…ç»„ä»¶å¤„äºæ´»è·ƒçŠ¶æ€çš„æ—¶å€™æ‰é€šçŸ¥æ›´æ–°  </p>
<p>çœ‹åˆ°è¿™é‡Œæ˜¯ä¸æ˜¯å°±æƒ³èµ·æ¥å‰é¢è¯´çš„æ•°æ®ç»‘å®šæ“ä½œï¼Ÿ<br>æ²¡é”™ï¼Œè¿™æ ·ä»£ç å°±å˜æˆäº†ä»‹ä¸ªæ ·å­<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SampleModel</span> : <span class="type">ViewModel</span></span>() &#123;</span><br><span class="line">    <span class="keyword">val</span> profileData = MutableLiveData&lt;UserInfo&gt;()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> profile: UserInfo? = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCleared</span><span class="params">()</span></span> &#123;</span><br><span class="line">        profile = <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">fetchUserInfo</span><span class="params">()</span></span> &#123;</span><br><span class="line">        â€¦</span><br><span class="line">        <span class="comment">// ç½‘ç»œæˆ–æœ¬åœ°æŒä¹…åŒ–æ•°æ®è·å–ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line">        â€¦</span><br><span class="line">        <span class="comment">// è·å–æˆåŠŸåä½¿ç”¨ LiveData é€šçŸ¥è®¢é˜…ç«¯</span></span><br><span class="line">        profileData.postValue(profile)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SampleActivity</span> : <span class="type">AppCompatActivity</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> viewModel <span class="keyword">by</span> lazy &#123; ViewModelProviders.of(activity).<span class="keyword">get</span>(SampleModel::<span class="class"><span class="keyword">class</span>.<span class="title">java</span>) &#125;</span></span><br><span class="line">    â€¦</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        â€¦</span><br><span class="line">        viewModel.profileData.observe(<span class="keyword">this</span>, Observer &#123;</span><br><span class="line">            it?.also &#123;</span><br><span class="line">                <span class="comment">// it -&gt; æ¥æ”¶åˆ°çš„ UserInfo</span></span><br><span class="line">                â€¦</span><br><span class="line">                â€¦</span><br><span class="line">                <span class="comment">/* æ›´æ–° UI */</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¿™æ ·ä¸€æ¥ï¼Œ<code>ViewModel</code> åªéœ€è¦æ‰®æ¼”æ•°æ®æŒæœ‰è€…ä»¥åŠç›¸å…³ä¸šåŠ¡æ§åˆ¶å™¨ï¼Œä¸ç”¨åƒ <strong>Presenter</strong> é‚£æ ·éœ€è¦å…³å¿ƒ <strong>View</strong> å±‚çš„æ¥å£å˜åŒ–äº†ï¼Œè€Œä¸”èƒ½å¤Ÿæœ‰æ•ˆé¿å…å›  <strong>Presenter</strong> æŒæœ‰ <strong>View</strong> å¼•ç”¨é€ æˆçš„å†…å­˜æ³„æ¼é—®é¢˜</p>
<p>è¿™é‡Œç®€å•çœ‹ä¸€ä¸‹ <code>LiveData</code> çš„ä»£ç <br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Posts a task to a main thread to set the given value. So if you have a following code</span></span><br><span class="line"><span class="comment">     * executed in the main thread:</span></span><br><span class="line"><span class="comment">     * &lt;pre class="prettyprint"&gt;</span></span><br><span class="line"><span class="comment">     * liveData.postValue("a");</span></span><br><span class="line"><span class="comment">     * liveData.setValue("b");</span></span><br><span class="line"><span class="comment">     * &lt;/pre&gt;</span></span><br><span class="line"><span class="comment">     * The value "b" would be set at first and later the main thread would override it with</span></span><br><span class="line"><span class="comment">     * the value "a".</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * If you called this method multiple times before a main thread executed a posted task, only</span></span><br><span class="line"><span class="comment">     * the last value would be dispatched.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value The new value</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">postValue</span><span class="params">(T value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> postTask;</span><br><span class="line">        <span class="keyword">synchronized</span> (mDataLock) &#123;</span><br><span class="line">            postTask = mPendingData == NOT_SET;</span><br><span class="line">            mPendingData = value;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!postTask) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ArchTaskExecutor.getInstance().postToMainThread(mPostValueRunnable);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Sets the value. If there are active observers, the value will be dispatched to them.</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * This method must be called from the main thread. If you need set a value from a background</span></span><br><span class="line"><span class="comment">     * thread, you can use &#123;<span class="doctag">@link</span> #postValue(Object)&#125;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value The new value</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@MainThread</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">setValue</span><span class="params">(T value)</span> </span>&#123;</span><br><span class="line">        assertMainThread(<span class="string">"setValue"</span>);</span><br><span class="line">        mVersion++;</span><br><span class="line">        mData = value;</span><br><span class="line">        dispatchingValue(<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>å¯ä»¥çœ‹å‡º LiveData é€šè¿‡è®¾ç½® value æ¥é©±åŠ¨æ•°æ®å˜åŒ–äº‹ä»¶ï¼Œå†…éƒ¨é€šè¿‡åˆ†å‘æ–°çš„ data é€šçŸ¥åˆ°è®¢é˜…è€…ï¼ˆé€šå¸¸æ˜¯UIç•Œé¢çš„æ•°æ®æ¸²æŸ“ä»£ç ï¼‰<br>è¿™é‡Œæœ‰ä¸¤ä¸ªç›¸å…³çš„æ–¹æ³•ï¼š<code>setValue</code> ä»¥åŠ <code>postValue</code><br>æŸ¥çœ‹ <code>postValue</code> æ–¹æ³•æœ€åä¸€è¡Œå¯ä»¥çœ‹å‡ºé€šè¿‡ post æ¥æ”¹å˜æ•°æ®æ—¶ï¼Œå†…éƒ¨ä¼šé€šè¿‡ä¸€ä¸ªä»»åŠ¡è°ƒåº¦å™¨æ¥äº‹ä»¶åˆ†å‘åˆ°ä¸»çº¿ç¨‹ï¼Œ<br>è€Œ <code>setValue</code> æ–¹æ³•é€šè¿‡æ³¨è§£å£°æ˜ä»¥åŠé¦–è¡Œçš„æ–­è¨€æ£€æŸ¥å¯çŸ¥ï¼Œæ­¤æ–¹æ³•éœ€è¦åœ¨ä¸»çº¿ç¨‹ä¸­è°ƒç”¨ï¼Œè¿™æ„å‘³ç€è®¢é˜…çš„ Observer <strong>å§‹ç»ˆä¼šåœ¨ä¸»çº¿ç¨‹ä¸­å“åº”</strong></p>
<p>è¿™ä¸¤ä¸ªæ–¹æ³•çš„å¯è§æ€§ä¿®é¥°æ˜¯ <code>protected</code>ï¼Œæ„å‘³ç€å¼€å‘è€…ä¸èƒ½ç›´æ¥è°ƒç”¨ï¼Œæ‰€ä»¥ <strong>LiveData</strong> æä¾›äº†ä¸€ä¸ªå­ç±» <code>MutableLiveData</code><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> LiveData&#125; which publicly exposes &#123;<span class="doctag">@link</span> #setValue(T)&#125; and &#123;<span class="doctag">@link</span> #postValue(T)&#125; method.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;T&gt; The type of data hold by this instance</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MutableLiveData</span>&lt;<span class="title">T</span>&gt; <span class="keyword">extends</span> <span class="title">LiveData</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postValue</span><span class="params">(T value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.postValue(value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setValue</span><span class="params">(T value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.setValue(value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä»£ç éå¸¸ç®€å•ï¼Œåªæ˜¯å•çº¯çš„ä¿®æ”¹äº†è¿™ä¸ªä¸¤ä¸ªæ›´æ–°æ•°æ®çš„æ–¹æ³•çš„ä¿®é¥°ï¼Œæš´éœ²ç»™äº†å¼€å‘è€…è°ƒç”¨<br>å½“æˆ‘ä»¬éœ€è¦æ”¹å˜æ•°æ®çš„æ—¶å€™åªéœ€è¦è°ƒç”¨ä¸€ä¸‹ <code>postValue</code> æ–¹æ³•å°±å¯ä»¥é€šçŸ¥è§†å›¾è®¢é˜…æ¥æ›´æ–°è§†å›¾æ˜¾ç¤ºçš„å†…å®¹å’ŒçŠ¶æ€äº†ï¼Œå°±åƒ <strong>React</strong> ä¸­ å¯¹ <code>props</code> å’Œ <code>stat</code> èµ‹å€¼ä¸€æ ·ç®€å•</p>
<p>æ‰€ä»¥ â€¦ èµ¶ç´§å¼€å§‹æ‹¥æŠ±ã€ä»¥åŠäº«å— <strong>ViewModel</strong> + <strong>LiveData</strong> å¸¦æ¥çš„ä¾¿æ·å§</p>

    </div>

    

    
        <div class="post-tags">
            <i class="fa fa-tags" aria-hidden="true"></i>
            <a href="/tags/Android/">#Android</a>
        </div>
    

    <!-- Comments -->
    

</div>
        </section>

    </div>
</div>


</div>

<!-- Footer -->
<div class="push"></div>

<footer class="footer-content">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 footer-about">
                <h2>About</h2>
                <p>
                    This theme was developed by <a href="https://github.com/klugjo">Jonathan Klughertz</a>. The source code is available on Github. Create Websites. Make Magic.
                </p>
            </div>
            
    <div class="col-xs-6 col-sm-6 col-md-3 col-lg-3 recent-posts">
        <h2>Recent Posts</h2>
        <ul>
            
            <li>
                <a class="footer-post" href="/2018/11/26/android-view-model/">Android-ViewModel ä½¿ç”¨æŒ‡åŒ—</a>
            </li>
            
        </ul>
    </div>



            
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <ul class="list-inline footer-social-icons">
                    
                    <li class="list-inline-item">
                        <a href="https://github.com/klugjo/hexo-theme-alpha-dust">
                            <span class="footer-icon-container">
                                <i class="fa fa-github"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://twitter.com/?lang=en">
                            <span class="footer-icon-container">
                                <i class="fa fa-twitter"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://www.facebook.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-facebook"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://www.instagram.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-instagram"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://dribbble.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-dribbble"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://plus.google.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-google-plus"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://www.behance.net/">
                            <span class="footer-icon-container">
                                <i class="fa fa-behance"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://500px.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-500px"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="mailto:test@example.com">
                            <span class="footer-icon-container">
                                <i class="fa fa-envelope-o"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="\#">
                            <span class="footer-icon-container">
                                <i class="fa fa-rss"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <div class="footer-copyright">
                    @Untitled. All right reserved | Design & Hexo <a href="http://www.codeblocq.com/">Jonathan Klughertz</a>
                </div>
            </div>
        </div>
    </div>
</footer>

<!-- After footer scripts -->

<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Tween Max -->
<script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.5/TweenMax.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Custom JavaScript -->
<script src="/js/main.js"></script>

<!-- Disqus Comments -->



</body>

</html>